{"version":3,"sources":["../src/index.js"],"sourcesContent":["import errorConstructors from './error-constructors.js';\n\nexport class NonError extends Error {\n\tname = 'NonError';\n\n\tconstructor(message) {\n\t\tsuper(NonError._prepareSuperMessage(message));\n\t}\n\n\tstatic _prepareSuperMessage(message) {\n\t\ttry {\n\t\t\treturn JSON.stringify(message);\n\t\t} catch {\n\t\t\treturn String(message);\n\t\t}\n\t}\n}\n\nconst commonProperties = [\n\t{\n\t\tproperty: 'name',\n\t\tenumerable: false,\n\t},\n\t{\n\t\tproperty: 'message',\n\t\tenumerable: false,\n\t},\n\t{\n\t\tproperty: 'stack',\n\t\tenumerable: false,\n\t},\n\t{\n\t\tproperty: 'code',\n\t\tenumerable: true,\n\t},\n\t{\n\t\tproperty: 'cause',\n\t\tenumerable: false,\n\t},\n];\n\nconst toJsonWasCalled = new WeakSet();\n\nconst toJSON = (from) => {\n\ttoJsonWasCalled.add(from);\n\tconst json = from.toJSON();\n\ttoJsonWasCalled.delete(from);\n\treturn json;\n};\n\nconst getErrorConstructor = (name) => errorConstructors.get(name) ?? Error;\n\n// eslint-disable-next-line complexity\nconst destroyCircular = ({ from, seen, to, forceEnumerable, maxDepth, depth, useToJSON, serialize }) => {\n\tif (!to) {\n\t\tif (Array.isArray(from)) {\n\t\t\tto = [];\n\t\t} else if (!serialize && isErrorLike(from)) {\n\t\t\tconst Error = getErrorConstructor(from.name);\n\t\t\tto = new Error();\n\t\t} else {\n\t\t\tto = {};\n\t\t}\n\t}\n\n\tseen.push(from);\n\n\tif (depth >= maxDepth) {\n\t\treturn to;\n\t}\n\n\tif (useToJSON && typeof from.toJSON === 'function' && !toJsonWasCalled.has(from)) {\n\t\treturn toJSON(from);\n\t}\n\n\tconst continueDestroyCircular = (value) =>\n\t\tdestroyCircular({\n\t\t\tfrom: value,\n\t\t\tseen: [...seen],\n\t\t\tforceEnumerable,\n\t\t\tmaxDepth,\n\t\t\tdepth,\n\t\t\tuseToJSON,\n\t\t\tserialize,\n\t\t});\n\n\tfor (const [key, value] of Object.entries(from)) {\n\t\t// eslint-disable-next-line node/prefer-global/buffer\n\t\tif (typeof Buffer === 'function' && Buffer.isBuffer(value)) {\n\t\t\tto[key] = '[object Buffer]';\n\t\t\tcontinue;\n\t\t}\n\n\t\t// TODO: Use `stream.isReadable()` when targeting Node.js 18.\n\t\tif (value !== null && typeof value === 'object' && typeof value.pipe === 'function') {\n\t\t\tto[key] = '[object Stream]';\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (typeof value === 'function') {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!value || typeof value !== 'object') {\n\t\t\t// Gracefully handle non-configurable errors like `DOMException`.\n\t\t\ttry {\n\t\t\t\tto[key] = value;\n\t\t\t} catch {}\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!seen.includes(from[key])) {\n\t\t\tdepth++;\n\t\t\tto[key] = continueDestroyCircular(from[key]);\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tto[key] = '[Circular]';\n\t}\n\n\tfor (const { property, enumerable } of commonProperties) {\n\t\tif (typeof from[property] !== 'undefined' && from[property] !== null) {\n\t\t\tObject.defineProperty(to, property, {\n\t\t\t\tvalue: isErrorLike(from[property]) ? continueDestroyCircular(from[property]) : from[property],\n\t\t\t\tenumerable: forceEnumerable ? true : enumerable,\n\t\t\t\tconfigurable: true,\n\t\t\t\twritable: true,\n\t\t\t});\n\t\t}\n\t}\n\n\treturn to;\n};\n\nexport function serializeError(value, options = {}) {\n\tconst { maxDepth = Number.POSITIVE_INFINITY, useToJSON = true } = options;\n\n\tif (typeof value === 'object' && value !== null) {\n\t\treturn destroyCircular({\n\t\t\tfrom: value,\n\t\t\tseen: [],\n\t\t\tforceEnumerable: true,\n\t\t\tmaxDepth,\n\t\t\tdepth: 0,\n\t\t\tuseToJSON,\n\t\t\tserialize: true,\n\t\t});\n\t}\n\n\t// People sometimes throw things besides Error objectsâ€¦\n\tif (typeof value === 'function') {\n\t\t// `JSON.stringify()` discards functions. We do too, unless a function is thrown directly.\n\t\t// We intentionally use `||` because `.name` is an empty string for anonymous functions.\n\t\treturn `[Function: ${value.name || 'anonymous'}]`;\n\t}\n\n\treturn value;\n}\n\nexport function deserializeError(value, options = {}) {\n\tconst { maxDepth = Number.POSITIVE_INFINITY } = options;\n\n\tif (value instanceof Error) {\n\t\treturn value;\n\t}\n\n\tif (isMinimumViableSerializedError(value)) {\n\t\tconst Error = getErrorConstructor(value.name);\n\t\treturn destroyCircular({\n\t\t\tfrom: value,\n\t\t\tseen: [],\n\t\t\tto: new Error(),\n\t\t\tmaxDepth,\n\t\t\tdepth: 0,\n\t\t\tserialize: false,\n\t\t});\n\t}\n\n\treturn new NonError(value);\n}\n\nexport function isErrorLike(value) {\n\treturn Boolean(value) && typeof value === 'object' && 'name' in value && 'message' in value && 'stack' in value;\n}\n\nfunction isMinimumViableSerializedError(value) {\n\treturn Boolean(value) && typeof value === 'object' && 'message' in value && !Array.isArray(value);\n}\n\nexport { default as errorConstructors } from './error-constructors.js';\n"],"mappings":"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","names":["import_error_constructors","errorConstructors","Error"]}